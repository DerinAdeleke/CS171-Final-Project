<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Luxury Fashion Data Story</title>
    <link rel="stylesheet" href="css/style.css">
    <script src="https://d3js.org/d3.v7.min.js"></script>
    <script src="https://unpkg.com/topojson@3"></script>
</head>
<body>
    <!-- EMPTY container: slides will be injected by slides/*.js -->
    <div class="scroll-container"></div>

    <!-- Load slide modules (inject HTML into .scroll-container) -->
    <script src="slides/slide1.js"></script>
    <script src="slides/slide1_5.js"></script>
    <script src="slides/slide2.js"></script>
    <script src="slides/slide3.js"></script>
    <script src="slides/slide4.js"></script>
    <script src="slides/slide5.js"></script>
    <script src="slides/slide6.js"></script>
    <script src="slides/slide7.js"></script>
    <script src="slides/slide7_5.js"></script>
    <script src="slides/slide8.js"></script>
    <script src="slides/slide8_5.js"></script>
    <script src="slides/slide9.js"></script>
    <script src="slides/slide10.js"></script>
    <script src="slides/slide11.js"></script>
    <script src="slides/slide12.js"></script>
    <script src="slides/slide13.js"></script>
    <script src="slides/slide14.js"></script>
    <script src="slides/slide15.js"></script>
    <script src="slides/slide16.js"></script>
    <script src="slides/slide17.js"></script>
    <script src="slides/slide18.js"></script>
    <script src="slides/slide19.js"></script>

    <!-- Tooltip -->
    <div class="tooltip"></div>

    <script>
        // Luxury Brands Chart Visualization
        const tooltip = d3.select(".tooltip");

        async function createLuxuryBrandsChart() {
            try {
                const rawData = await d3.csv("data/Top leading luxury brands.csv");
                
                // Parse the data (skip header rows and clean)
                const data = rawData
                    .filter(d => d['Most valuable global luxury brands 2025'] && 
                                 d['Most valuable global luxury brands 2025'].includes(' '))
                    .map(d => {
                        const text = d['Most valuable global luxury brands 2025'];
                        const parts = text.split(' ');
                        const country = parts[parts.length - 1];
                        const brand = parts.slice(0, -1).join(' ');
                        const value = parseFloat(d[''].replace(/,/g, ''));
                        return { brand, country, value };
                    })
                    .filter(d => !isNaN(d.value))
                    .sort((a, b) => b.value - a.value)
                    .slice(0, 10);

                const totalValue = d3.sum(data, d => d.value);

                const width = 550;
                const height = 550;
                const radius = Math.min(width, height) / 2;

                const svg = d3.select("#luxuryBrandsChart")
                    .append("svg")
                    .attr("width", width)
                    .attr("height", height)
                    .append("g")
                    .attr("transform", `translate(${width / 2}, ${height / 2})`);

                // Color scale with gold and earth tones
                const colorScale = d3.scaleOrdinal()
                    .domain(data.map(d => d.brand))
                    .range([
                        '#d4af37', '#c9a961', '#bfa47a', '#b89f6f',
                        '#a89968', '#9a8f5e', '#8d8556', '#8b7d6b',
                        '#7a6f4d', '#6b6142'
                    ]);

                const pie = d3.pie()
                    .value(d => d.value)
                    .sort(null);

                const arc = d3.arc()
                    .innerRadius(radius * 0.4)
                    .outerRadius(radius * 0.85);

                const arcHover = d3.arc()
                    .innerRadius(radius * 0.4)
                    .outerRadius(radius * 0.88);

                // Draw arcs
                const arcs = svg.selectAll(".brand-arc")
                    .data(pie(data))
                    .join("path")
                    .attr("class", "brand-arc")
                    .attr("fill", d => colorScale(d.data.brand))
                    .attr("stroke", "#0a0a0a")
                    .attr("stroke-width", 2)
                    .style("opacity", 0)
                    .on("mouseover", function(event, d) {
                        d3.select(this)
                            .transition()
                            .duration(200)
                            .attr("d", arcHover);
                        
                        const percentage = ((d.data.value / totalValue) * 100).toFixed(1);
                        tooltip
                            .style("opacity", 1)
                            .html(`
                                <strong>${d.data.brand}</strong><br/>
                                Value: $${d.data.value.toFixed(1)}B<br/>
                                Country: ${d.data.country}<br/>
                                Market Share: ${percentage}%
                            `)
                            .style("left", (event.pageX + 15) + "px")
                            .style("top", (event.pageY - 28) + "px");
                    })
                    .on("mousemove", function(event) {
                        tooltip
                            .style("left", (event.pageX + 15) + "px")
                            .style("top", (event.pageY - 28) + "px");
                    })
                    .on("mouseout", function() {
                        d3.select(this)
                            .transition()
                            .duration(200)
                            .attr("d", arc);
                        
                        tooltip.style("opacity", 0);
                    });

                // Animate arcs in with stagger
                arcs.transition()
                    .duration(800)
                    .delay((d, i) => i * 80)
                    .style("opacity", 1)
                    .attrTween("d", function(d) {
                        const interpolate = d3.interpolate({ startAngle: 0, endAngle: 0 }, d);
                        return function(t) {
                            return arc(interpolate(t));
                        };
                    });

                // Center circle
                svg.append("circle")
                    .attr("class", "center-circle")
                    .attr("r", radius * 0.38)
                    .style("opacity", 0)
                    .transition()
                    .delay(500)
                    .duration(600)
                    .style("opacity", 1);

                // Center text
                svg.append("text")
                    .attr("class", "center-value")
                    .attr("y", -10)
                    .text(`$${(totalValue / 1000).toFixed(1)}B`)
                    .style("opacity", 0)
                    .transition()
                    .delay(800)
                    .duration(600)
                    .style("opacity", 1);

                svg.append("text")
                    .attr("class", "center-label")
                    .attr("y", 15)
                    .text("TOP 10 BRANDS")
                    .style("opacity", 0)
                    .transition()
                    .delay(800)
                    .duration(600)
                    .style("opacity", 1);

            } catch (error) {
                console.error("Error loading luxury brands data:", error);
            }
        }

        // Expose to global scope
        window.createLuxuryBrandsChart = createLuxuryBrandsChart;
    </script>

    <script>
        // Scroll Navigation
        function scrollToSlide(index) {
            const allSlides = document.querySelectorAll('.slide');
            allSlides[index].scrollIntoView({ behavior: 'smooth' });
        }

        // Add bottom navigation buttons to all slides except the last
        setTimeout(() => {
            const allSlides = document.querySelectorAll('.slide');
            allSlides.forEach((slide, index) => {
                if (index < allSlides.length - 1) {
                    const btn = document.createElement('div');
                    btn.className = 'next-slide-btn';
                    btn.innerHTML = '<svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="#d4af37" stroke-width="2"><path d="M12 5v14M19 12l-7 7-7-7"/></svg>';
                    btn.onclick = () => scrollToSlide(index + 1);
                    slide.appendChild(btn);
                }
            });
        }, 500);

        // Update slide visibility on scroll
        const scrollContainer = document.querySelector('.scroll-container');

        scrollContainer.addEventListener('scroll', () => {
            const scrollPosition = scrollContainer.scrollTop;
            const windowHeight = window.innerHeight;
            const allSlides = document.querySelectorAll('.slide');

            allSlides.forEach((slide, index) => {
                const slideTop = slide.offsetTop;
                const slideBottom = slideTop + slide.offsetHeight;

                if (scrollPosition >= slideTop - windowHeight / 2 && scrollPosition < slideBottom - windowHeight / 2) {
                    const content = slide.querySelector('.slide-content');
                    if (content && !content.classList.contains('visible')) {
                        content.classList.add('visible');
                    }
                }
            });
        });

        // Initialize first slide
        setTimeout(() => {
            const firstContent = document.querySelector('.slide-content');
            if (firstContent) firstContent.classList.add('visible');
        }, 100);

        // Shared data
        window.brandColors = {
            "Hermès": "#8B2635",
            "Gucci": "#d4af37",
            "Coach": "#8b4513"
        };

        window.revenueData = [
            {Year: 2012, "Hermès": 4128, Gucci: 3790, Coach: 910},
            {Year: 2013, "Hermès": 4435, Gucci: 4230, Coach: 970},
            {Year: 2014, "Hermès": 4832, Gucci: 4550, Coach: 940},
            {Year: 2015, "Hermès": 5108, Gucci: 4950, Coach: 940},
            {Year: 2016, "Hermès": 6135, Gucci: 5439, Coach: 940},
            {Year: 2017, "Hermès": 6701, Gucci: 6883, Coach: 1010},
            {Year: 2018, "Hermès": 7035, Gucci: 8594, Coach: 1040},
            {Year: 2019, "Hermès": 7709, Gucci: 10192, Coach: 1060},
            {Year: 2020, "Hermès": 7295, Gucci: 17630, Coach: 1080},
            {Year: 2021, "Hermès": 10626, Gucci: 15599, Coach: 1100},
            {Year: 2022, "Hermès": 12219, Gucci: 18110, Coach: 1120},
            {Year: 2023, "Hermès": 14535, Gucci: 17839, Coach: 1140},
            {Year: 2024, "Hermès": 16414, Gucci: 14864, Coach: 1170}
        ];

        window.resaleData = [
            {brand: "Coach", category: "Accessories", count: 1627, mean: 104.74},
            {brand: "Coach", category: "Apparel", count: 210, mean: 245.97},
            {brand: "Coach", category: "Shoes", count: 427, mean: 116.26},
            {brand: "Gucci", category: "Accessories", count: 17914, mean: 313.82},
            {brand: "Gucci", category: "Apparel", count: 6668, mean: 688.45},
            {brand: "Gucci", category: "Shoes", count: 17533, mean: 498.12},
            {brand: "Hermès", category: "Accessories", count: 12431, mean: 621.87},
            {brand: "Hermès", category: "Apparel", count: 2247, mean: 1181.56},
            {brand: "Hermès", category: "Shoes", count: 5084, mean: 567.15}
        ];

        // Initialize visualizations when slides become visible
        const observer = new IntersectionObserver((entries) => {
            entries.forEach(entry => {
                if (entry.isIntersecting) {
                    const slideContent = entry.target.querySelector('.slide-content');
                    if (slideContent && !slideContent.classList.contains('visible')) {
                        slideContent.classList.add('visible');
                    }

                    if (entry.target.classList.contains('intro-slide') && !entry.target.dataset.initialized) {
                        if (window.createLuxuryBrandsChart) window.createLuxuryBrandsChart();
                        entry.target.dataset.initialized = true;
                    }
                    if (entry.target.classList.contains('slide-3') && !entry.target.dataset.initialized) {
                        if (window.createBrandTimeline) window.createBrandTimeline();
                        entry.target.dataset.initialized = true;
                    }
                    if (entry.target.classList.contains('slide-6') && !entry.target.dataset.initialized) {
                        if (window.createOverviewChart) window.createOverviewChart();
                        entry.target.dataset.initialized = true;
                    }
                    if (entry.target.classList.contains('slide-6-5') && !entry.target.dataset.initialized) {
                        if (window.createStreamgraph) window.createStreamgraph();
                        entry.target.dataset.initialized = true;
                    }
                    if (entry.target.classList.contains('slide-7') && !entry.target.dataset.initialized) {
                        if (window.createGlobalTrafficViz) window.createGlobalTrafficViz();
                        entry.target.dataset.initialized = true;
                    }
                    if (entry.target.classList.contains('slide-7-5') && !entry.target.dataset.initialized) {
                        if (window.createWorldMap) window.createWorldMap();
                        entry.target.dataset.initialized = true;
                    }
                    if (entry.target.classList.contains('slide-9') && !entry.target.dataset.initialized) {
                        if (window.loadProducts) window.loadProducts();
                        entry.target.dataset.initialized = true;
                    }
                    if (entry.target.classList.contains('slide-10') && !entry.target.dataset.initialized) {
                        if (window.createDistributionChart) window.createDistributionChart();
                        entry.target.dataset.initialized = true;
                    }
                    if (entry.target.classList.contains('slide-12') && !entry.target.dataset.initialized) {
                        if (window.createResaleChart) window.createResaleChart();
                        entry.target.dataset.initialized = true;
                    }
                    if (entry.target.classList.contains('slide-vestiaire') && !entry.target.dataset.initialized) {
                        if (window.createVestiaireViz) window.createVestiaireViz();
                        entry.target.dataset.initialized = true;
                    }
                }
            });
        }, { threshold: 0.3 });

        const observedSlides = document.querySelectorAll('.slide');
        observedSlides.forEach(slide => observer.observe(slide));
    </script>
</body>
</html>
