<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Luxury Fashion: A Data Story</title>
    <script src="https://d3js.org/d3.v7.min.js"></script>
    <style>
        body {
            font-family: 'Georgia', serif;
            background: linear-gradient(135deg, #f5f5f0 0%, #e8e8e0 100%);
            margin: 0;
            padding: 20px;
            color: #333;
        }
        
        .container {
            max-width: 1400px;
            margin: 0 auto;
            background: white;
            padding: 40px;
            box-shadow: 0 10px 40px rgba(0,0,0,0.1);
            border-radius: 10px;
        }
        
        h1 {
            text-align: center;
            font-size: 3em;
            color: #2c2c2c;
            margin-bottom: 10px;
            letter-spacing: 2px;
            text-transform: uppercase;
        }
        
        .subtitle {
            text-align: center;
            font-size: 1.2em;
            color: #666;
            margin-bottom: 30px;
            font-style: italic;
        }
        
        .story {
            background: linear-gradient(135deg, #1a1a1a 0%, #2d2d2d 100%);
            padding: 30px;
            margin: 30px 0;
            border-radius: 10px;
            color: #f5f5f5;
            line-height: 1.8;
            font-size: 1.1em;
            box-shadow: 0 5px 20px rgba(0,0,0,0.2);
            border-left: 5px solid #d4af37;
        }
        
        .visualization {
            margin: 60px 0;
            padding: 30px;
            background: #fafafa;
            border-radius: 10px;
            box-shadow: 0 3px 15px rgba(0,0,0,0.05);
        }
        
        .viz-title {
            font-size: 1.8em;
            margin-bottom: 10px;
            color: #2c2c2c;
            text-align: center;
            font-weight: bold;
        }
        
        .viz-description {
            text-align: center;
            color: #666;
            margin-bottom: 30px;
            font-style: italic;
        }
        
        svg {
            display: block;
            margin: 0 auto;
        }
        
        .tooltip {
            position: absolute;
            background: rgba(0, 0, 0, 0.9);
            color: white;
            padding: 12px 16px;
            border-radius: 8px;
            pointer-events: none;
            opacity: 0;
            transition: opacity 0.3s;
            font-size: 14px;
            box-shadow: 0 5px 15px rgba(0,0,0,0.3);
            z-index: 1000;
        }
        
        .axis text {
            font-size: 12px;
            font-family: sans-serif;
        }
        
        .legend {
            font-size: 14px;
            font-family: sans-serif;
        }
        
        .brand-button {
            padding: 10px 20px;
            margin: 5px;
            border: 2px solid #333;
            background: white;
            cursor: pointer;
            border-radius: 5px;
            font-size: 14px;
            transition: all 0.3s;
        }
        
        .brand-button:hover {
            background: #333;
            color: white;
        }
        
        .brand-button.active {
            background: #d4af37;
            border-color: #d4af37;
            color: white;
        }
        
        .controls {
            text-align: center;
            margin: 20px 0;
        }
    </style>
</head>
<body>
    <div class="container">
        <h1>The Luxury Fashion Paradox</h1>
        <div class="subtitle">Three Brands, Three Trajectories, One Story</div>
        
        <div class="story">
            <p><strong>The data reveals a fascinating tale of three luxury powerhouses navigating dramatically different paths in the modern fashion landscape.</strong> While Hermès has orchestrated a near-perfect crescendo of growth—tripling its revenue from $4.1B to $16.4B between 2012 and 2024—Gucci's trajectory tells a more turbulent story of explosive growth followed by sobering contraction. Most intriguingly, Coach has remained remarkably stable, hovering around $1B in revenue for over a decade, despite the luxury market's wild fluctuations.</p>
            
            <p>The resale market data adds another layer to this narrative: Hermès commands astronomical median resale prices ($897 for shoes, $376 for accessories) compared to Coach's modest $89-$93, suggesting that true luxury maintains its value even in secondary markets. Meanwhile, the regional data exposes a critical dependence on Asia-Pacific markets, particularly China, which accounts for nearly half of Gucci's revenue but shows signs of vulnerability. Perhaps most revealing is that while Gucci's leather goods generate nearly $4B annually, its average resale price is only $269—suggesting massive volume but questionable exclusivity compared to Hermès' scarcity-driven model. This is the luxury paradox: growth versus prestige, accessibility versus exclusivity, and the eternal question of whether bigger truly means better in the world of high fashion.</p>
        </div>

        <!-- Visualization 1: Animated Revenue Race -->
        <div class="visualization">
            <div class="viz-title">1. The Revenue Race: A 12-Year Journey</div>
            <div class="viz-description">Watch as three luxury giants compete for dominance (2012-2024)</div>
            <div class="controls">
                <button id="play-btn" class="brand-button">▶ Play Animation</button>
                <button id="reset-btn" class="brand-button">⟲ Reset</button>
            </div>
            <div id="race-chart"></div>
        </div>

        <!-- Visualization 2: Radial Resale Price Distribution -->
        <div class="visualization">
            <div class="viz-title">2. The Price Circle: Resale Value Distribution</div>
            <div class="viz-description">Hover to explore how each brand maintains its value in the secondary market</div>
            <div id="radial-chart"></div>
        </div>

        <!-- Visualization 3: Interactive Sunburst -->
        <div class="visualization">
            <div class="viz-title">3. Revenue Architecture: Category & Regional Breakdown</div>
            <div class="viz-description">Click to explore the hierarchical structure of luxury revenue streams (2024)</div>
            <div id="sunburst-chart"></div>
        </div>

        <!-- Visualization 4: Connected Scatter Plot -->
        <div class="visualization">
            <div class="viz-title">4. The Value Proposition: Volume vs. Price</div>
            <div class="viz-description">Interactive scatter plot revealing the relationship between resale volume and price</div>
            <div class="controls">
                <button class="brand-button category-filter active" data-category="all">All Categories</button>
                <button class="brand-button category-filter" data-category="Accessories">Accessories</button>
                <button class="brand-button category-filter" data-category="Apparel">Apparel</button>
                <button class="brand-button category-filter" data-category="Shoes">Shoes</button>
            </div>
            <div id="scatter-chart"></div>
        </div>

        <!-- Visualization 5: Force-Directed Network -->
        <div class="visualization">
            <div class="viz-title">5. The Luxury Ecosystem: Brand Collaborations & Categories</div>
            <div class="viz-description">Drag nodes to explore the interconnected world of luxury fashion</div>
            <div id="network-chart"></div>
        </div>

        <!-- Visualization 6: Search Interest Timeline -->
        <div class="visualization">
            <div class="viz-title">6. The Search Interest Saga: Google Trends (2004-2025)</div>
            <div class="viz-description">Brush to zoom into specific time periods and discover the rise and fall of brand popularity</div>
            <div id="timeline-chart"></div>
        </div>

        <!-- Visualization 7: Global Brand Dominance Map -->
        <div class="visualization">
            <div class="viz-title">7. Global Brand Dominance: Geographic Market Share</div>
            <div class="viz-description">Explore which brand dominates each country's search interest</div>
            <div id="geo-chart"></div>
        </div>

        <!-- Visualization 8: Hermès Price Distribution Violin Plot -->
        <div class="visualization">
            <div class="viz-title">8. The Hermès Premium: Price Distribution Analysis</div>
            <div class="viz-description">Explore the price ranges across Hermès categories with interactive violin plots</div>
            <div id="hermes-violin-chart"></div>
        </div>

        <!-- Visualization 9: Hermès Value Retention Waterfall -->
        <div class="visualization">
            <div class="viz-title">9. Hermès Value Dynamics: Quartile Price Flow</div>
            <div class="viz-description">Animated flow showing how Hermès items distribute across price ranges</div>
            <div class="controls">
                <button id="animate-waterfall" class="brand-button">▶ Animate Flow</button>
            </div>
            <div id="hermes-waterfall-chart"></div>
        </div>

        <!-- Visualization 10: Coach Condition Impact Heatmap -->
        <div class="visualization">
            <div class="viz-title">10. Coach Resale: Condition Matters</div>
            <div class="viz-description">How product condition affects Coach resale values across categories</div>
            <div class="controls">
                <button id="sort-heatmap" class="brand-button">Sort by Price</button>
            </div>
            <div id="coach-heatmap"></div>
        </div>

        <!-- Visualization 11: Coach Seller Performance -->
        <div class="visualization">
            <div class="viz-title">11. Coach Marketplace Dynamics</div>
            <div class="viz-description">Seller experience, pricing, and reputation in the Coach resale market</div>
            <div class="controls">
                <button class="filter-btn active" data-badge="all">All Sellers</button>
                <button class="filter-btn" data-badge="Expert">Expert</button>
                <button class="filter-btn" data-badge="Trusted">Trusted</button>
                <button class="filter-btn" data-badge="Common">Common</button>
            </div>
            <div id="coach-sellers"></div>
        </div>
    </div>

    <script>
        // Tooltip
        const tooltip = d3.select("body").append("div")
            .attr("class", "tooltip");

        // Color schemes
        const brandColors = {
            "Gucci": "#d4af37",
            "Coach": "#8b4513",
            "Hermes": "#2c2c2c",
            "Hermès": "#2c2c2c"
        };

        // Data
        const revenueData = [
            {Year: 2012, Gucci: 3790, Coach: 910, Hermes: 4128},
            {Year: 2013, Gucci: 4230, Coach: 970, Hermes: 4435},
            {Year: 2014, Gucci: 4550, Coach: 940, Hermes: 4832},
            {Year: 2015, Gucci: 4950, Coach: 940, Hermes: 5108},
            {Year: 2016, Gucci: 5439, Coach: 940, Hermes: 6135},
            {Year: 2017, Gucci: 6883, Coach: 1010, Hermes: 6701},
            {Year: 2018, Gucci: 8594, Coach: 1040, Hermes: 7035},
            {Year: 2019, Gucci: 10192, Coach: 1060, Hermes: 7709},
            {Year: 2020, Gucci: 17630, Coach: 1080, Hermes: 7295},
            {Year: 2021, Gucci: 15599, Coach: 1100, Hermes: 10626},
            {Year: 2022, Gucci: 18110, Coach: 1120, Hermes: 12219},
            {Year: 2023, Gucci: 17839, Coach: 1140, Hermes: 14535},
            {Year: 2024, Gucci: 14864, Coach: 1170, Hermes: 16414}
        ];

        const resaleData = [
            {brand: "Coach", category: "Accessories", count: 1627, mean: 104.74, median: 93.5},
            {brand: "Coach", category: "Apparel", count: 210, mean: 245.97, median: 183.61},
            {brand: "Coach", category: "Shoes", count: 427, mean: 116.26, median: 89.46},
            {brand: "Gucci", category: "Accessories", count: 17914, mean: 313.82, median: 269.5},
            {brand: "Gucci", category: "Apparel", count: 6668, mean: 688.45, median: 471.48},
            {brand: "Gucci", category: "Shoes", count: 17533, mean: 498.12, median: 434.52},
            {brand: "Hermès", category: "Accessories", count: 12431, mean: 621.87, median: 376.0},
            {brand: "Hermès", category: "Apparel", count: 1680, mean: 1217.1, median: 639.0},
            {brand: "Hermès", category: "Shoes", count: 4605, mean: 1016.97, median: 897.89}
        ];

        // VISUALIZATION 1: Animated Revenue Race
        function createRaceChart() {
            const margin = {top: 40, right: 100, bottom: 60, left: 100};
            const width = 1000 - margin.left - margin.right;
            const height = 500 - margin.top - margin.bottom;

            const svg = d3.select("#race-chart")
                .append("svg")
                .attr("width", width + margin.left + margin.right)
                .attr("height", height + margin.top + margin.bottom)
                .append("g")
                .attr("transform", `translate(${margin.left},${margin.top})`);

            const x = d3.scaleLinear()
                .domain([2012, 2024])
                .range([0, width]);

            const y = d3.scaleLinear()
                .domain([0, 20000])
                .range([height, 0]);

            const line = d3.line()
                .x(d => x(d.Year))
                .y(d => y(d.value));

            const brands = ["Gucci", "Coach", "Hermes"];
            
            // Draw axes
            svg.append("g")
                .attr("transform", `translate(0,${height})`)
                .call(d3.axisBottom(x).tickFormat(d3.format("d")))
                .style("font-size", "14px");

            svg.append("g")
                .call(d3.axisLeft(y).tickFormat(d => `$${d/1000}B`))
                .style("font-size", "14px");

            // Add labels
            svg.append("text")
                .attr("x", width / 2)
                .attr("y", height + 50)
                .attr("text-anchor", "middle")
                .style("font-size", "16px")
                .text("Year");

            svg.append("text")
                .attr("transform", "rotate(-90)")
                .attr("x", -height / 2)
                .attr("y", -70)
                .attr("text-anchor", "middle")
                .style("font-size", "16px")
                .text("Revenue (USD)");

            // Prepare data
            const brandData = brands.map(brand => ({
                brand: brand,
                values: revenueData.map(d => ({
                    Year: d.Year,
                    value: d[brand]
                }))
            }));

            // Draw lines
            const paths = svg.selectAll(".brand-line")
                .data(brandData)
                .join("path")
                .attr("class", "brand-line")
                .attr("fill", "none")
                .attr("stroke", d => brandColors[d.brand])
                .attr("stroke-width", 3)
                .attr("d", d => line(d.values));

            // Add animated circles
            const circles = svg.selectAll(".brand-circles")
                .data(brandData)
                .join("g")
                .attr("class", "brand-circles");

            circles.selectAll("circle")
                .data(d => d.values.map(v => ({brand: d.brand, ...v})))
                .join("circle")
                .attr("cx", d => x(d.Year))
                .attr("cy", d => y(d.value))
                .attr("r", 5)
                .attr("fill", d => brandColors[d.brand])
                .attr("opacity", 0.7)
                .on("mouseover", function(event, d) {
                    tooltip.style("opacity", 1)
                        .html(`<strong>${d.brand} (${d.Year})</strong><br>Revenue: $${(d.value/1000).toFixed(2)}B`)
                        .style("left", (event.pageX + 10) + "px")
                        .style("top", (event.pageY - 28) + "px");
                    d3.select(this).attr("r", 8);
                })
                .on("mouseout", function() {
                    tooltip.style("opacity", 0);
                    d3.select(this).attr("r", 5);
                });

            // Add brand labels at the end
            svg.selectAll(".brand-label")
                .data(brandData)
                .join("text")
                .attr("class", "brand-label")
                .attr("x", width + 10)
                .attr("y", d => y(d.values[d.values.length - 1].value))
                .attr("dy", "0.35em")
                .style("font-size", "14px")
                .style("font-weight", "bold")
                .style("fill", d => brandColors[d.brand])
                .text(d => d.brand);

            // Animation
            const totalLength = paths.nodes()[0].getTotalLength();
            
            paths.attr("stroke-dasharray", totalLength + " " + totalLength)
                .attr("stroke-dashoffset", totalLength);

            circles.selectAll("circle").attr("opacity", 0);

            function animate() {
                paths.transition()
                    .duration(3000)
                    .ease(d3.easeLinear)
                    .attr("stroke-dashoffset", 0);

                circles.selectAll("circle")
                    .transition()
                    .duration(3000)
                    .delay((d, i) => i * 230)
                    .attr("opacity", 0.7);
            }

            d3.select("#play-btn").on("click", animate);
            d3.select("#reset-btn").on("click", function() {
                paths.attr("stroke-dashoffset", totalLength);
                circles.selectAll("circle").attr("opacity", 0);
            });

            // Auto-play on load
            setTimeout(animate, 500);
        }

        // VISUALIZATION 2: Radial Chart
        function createRadialChart() {
            const width = 700;
            const height = 700;
            const innerRadius = 100;
            const outerRadius = Math.min(width, height) / 2 - 60;

            const svg = d3.select("#radial-chart")
                .append("svg")
                .attr("width", width)
                .attr("height", height)
                .append("g")
                .attr("transform", `translate(${width/2},${height/2})`);

            const angleScale = d3.scaleBand()
                .domain(resaleData.map((d, i) => i))
                .range([0, 2 * Math.PI])
                .padding(0.1);

            const radiusScale = d3.scaleLinear()
                .domain([0, d3.max(resaleData, d => d.median)])
                .range([innerRadius, outerRadius]);

            // Draw radial bars
            svg.selectAll(".radial-bar")
                .data(resaleData)
                .join("path")
                .attr("class", "radial-bar")
                .attr("fill", d => brandColors[d.brand])
                .attr("opacity", 0.8)
                .attr("d", d3.arc()
                    .innerRadius(innerRadius)
                    .outerRadius(d => radiusScale(d.median))
                    .startAngle((d, i) => angleScale(i))
                    .endAngle((d, i) => angleScale(i) + angleScale.bandwidth())
                    .padAngle(0.01)
                    .padRadius(innerRadius))
                .on("mouseover", function(event, d) {
                    d3.select(this).attr("opacity", 1).attr("stroke", "#fff").attr("stroke-width", 2);
                    tooltip.style("opacity", 1)
                        .html(`<strong>${d.brand} - ${d.category}</strong><br>
                               Median Resale: $${d.median}<br>
                               Mean: $${d.mean.toFixed(2)}<br>
                               Items Sold: ${d.count.toLocaleString()}`)
                        .style("left", (event.pageX + 10) + "px")
                        .style("top", (event.pageY - 28) + "px");
                })
                .on("mouseout", function() {
                    d3.select(this).attr("opacity", 0.8).attr("stroke", "none");
                    tooltip.style("opacity", 0);
                });

            // Add labels
            svg.selectAll(".radial-label")
                .data(resaleData)
                .join("text")
                .attr("class", "radial-label")
                .attr("text-anchor", "middle")
                .attr("transform", (d, i) => {
                    const angle = angleScale(i) + angleScale.bandwidth() / 2;
                    const radius = outerRadius + 30;
                    return `rotate(${(angle * 180 / Math.PI - 90)}) translate(${radius},0)`;
                })
                .text(d => `${d.brand.substring(0, 1)}`)
                .style("font-size", "12px")
                .style("font-weight", "bold")
                .style("fill", d => brandColors[d.brand]);

            // Center circle with legend
            svg.append("circle")
                .attr("r", innerRadius - 10)
                .attr("fill", "#f5f5f5")
                .attr("stroke", "#ddd")
                .attr("stroke-width", 2);

            svg.append("text")
                .attr("text-anchor", "middle")
                .attr("dy", "-10")
                .style("font-size", "16px")
                .style("font-weight", "bold")
                .text("Median");

            svg.append("text")
                .attr("text-anchor", "middle")
                .attr("dy", "10")
                .style("font-size", "16px")
                .style("font-weight", "bold")
                .text("Resale Price");
        }

        // VISUALIZATION 3: Sunburst
        function createSunburst() {
            const width = 800;
            const height = 800;
            const radius = Math.min(width, height) / 2;

            const svg = d3.select("#sunburst-chart")
                .append("svg")
                .attr("width", width)
                .attr("height", height)
                .append("g")
                .attr("transform", `translate(${width/2},${height/2})`);

            // Create hierarchical data
            const hierarchyData = {
                name: "Luxury Market",
                children: [
                    {
                        name: "Gucci",
                        children: [
                            {name: "Leather goods", value: 3825},
                            {name: "Ready-to-wear", value: 1300.5},
                            {name: "Shoes", value: 1530},
                            {name: "Watches and jewelry", value: 306},
                            {name: "Other", value: 688.5}
                        ]
                    },
                    {
                        name: "Hermès",
                        children: [
                            {name: "Leather Goods", value: 6457},
                            {name: "Ready-to-wear", value: 4405},
                            {name: "Silk and Textiles", value: 950},
                            {name: "Watches", value: 577},
                            {name: "Perfume", value: 535}
                        ]
                    },
                    {
                        name: "Coach",
                        children: [
                            {name: "Women's Handbags", value: 2495.7},
                            {name: "Women's Accessories", value: 1079.6},
                            {name: "Men's", value: 983.9},
                            {name: "Other Products", value: 536.1}
                        ]
                    }
                ]
            };

            const root = d3.hierarchy(hierarchyData)
                .sum(d => d.value)
                .sort((a, b) => b.value - a.value);

            const partition = d3.partition()
                .size([2 * Math.PI, radius]);

            partition(root);

            const arc = d3.arc()
                .startAngle(d => d.x0)
                .endAngle(d => d.x1)
                .innerRadius(d => d.y0)
                .outerRadius(d => d.y1);

            const color = d3.scaleOrdinal()
                .domain(["Gucci", "Hermès", "Coach"])
                .range([brandColors.Gucci, brandColors.Hermès, brandColors.Coach]);

            svg.selectAll("path")
                .data(root.descendants())
                .join("path")
                .attr("d", arc)
                .attr("fill", d => {
                    if (d.depth === 0) return "#fff";
                    if (d.depth === 1) return color(d.data.name);
                    return d3.color(color(d.parent.data.name)).brighter(0.5 + d.depth * 0.2);
                })
                .attr("stroke", "#fff")
                .attr("stroke-width", 2)
                .attr("opacity", 0.9)
                .style("cursor", "pointer")
                .on("mouseover", function(event, d) {
                    if (d.depth > 0) {
                        d3.select(this).attr("opacity", 1);
                        const brand = d.depth === 1 ? d.data.name : d.parent.data.name;
                        const category = d.depth === 1 ? "Total" : d.data.name;
                        const value = d.value || 0;
                        tooltip.style("opacity", 1)
                            .html(`<strong>${brand}</strong><br>${category}<br>€${value.toFixed(1)}M`)
                            .style("left", (event.pageX + 10) + "px")
                            .style("top", (event.pageY - 28) + "px");
                    }
                })
                .on("mouseout", function() {
                    d3.select(this).attr("opacity", 0.9);
                    tooltip.style("opacity", 0);
                })
                .on("click", function(event, d) {
                    if (d.depth > 0) {
                        const newRoot = d.depth === 1 ? d : d.parent;
                        
                        svg.transition()
                            .duration(750)
                            .tween("scale", () => {
                                const xd = d3.interpolate(root.x0, newRoot.x0);
                                const yd = d3.interpolate(root.y0, newRoot.y0);
                                const yr = d3.interpolate(root.y1, newRoot.y1);
                                return t => {
                                    root.x0 = xd(t);
                                    root.y0 = yd(t);
                                    root.y1 = yr(t);
                                };
                            })
                            .selectAll("path")
                            .attrTween("d", d => () => arc(d));
                    }
                });

            // Center label
            svg.append("text")
                .attr("text-anchor", "middle")
                .style("font-size", "20px")
                .style("font-weight", "bold")
                .text("2024 Revenue")
                .attr("dy", "0.35em");
        }

        // VISUALIZATION 4: Scatter Plot
        function createScatterPlot() {
            const margin = {top: 40, right: 100, bottom: 60, left: 80};
            const width = 900 - margin.left - margin.right;
            const height = 600 - margin.top - margin.bottom;

            const svg = d3.select("#scatter-chart")
                .append("svg")
                .attr("width", width + margin.left + margin.right)
                .attr("height", height + margin.top + margin.bottom)
                .append("g")
                .attr("transform", `translate(${margin.left},${margin.top})`);

            const x = d3.scaleLog()
                .domain([100, 20000])
                .range([0, width]);

            const y = d3.scaleLinear()
                .domain([0, 1300])
                .range([height, 0]);

            const sizeScale = d3.scaleSqrt()
                .domain([0, d3.max(resaleData, d => d.count)])
                .range([5, 40]);

            // Add axes
            svg.append("g")
                .attr("transform", `translate(0,${height})`)
                .call(d3.axisBottom(x).tickFormat(d => d.toLocaleString()))
                .style("font-size", "12px");

            svg.append("g")
                .call(d3.axisLeft(y).tickFormat(d => `$${d}`))
                .style("font-size", "12px");

            svg.append("text")
                .attr("x", width / 2)
                .attr("y", height + 50)
                .attr("text-anchor", "middle")
                .style("font-size", "14px")
                .text("Items Sold (log scale)");

            svg.append("text")
                .attr("transform", "rotate(-90)")
                .attr("x", -height / 2)
                .attr("y", -60)
                .attr("text-anchor", "middle")
                .style("font-size", "14px")
                .text("Median Resale Price ($)");

            function updateScatter(category) {
                const filteredData = category === "all" 
                    ? resaleData 
                    : resaleData.filter(d => d.category === category);

                const circles = svg.selectAll(".scatter-circle")
                    .data(filteredData, d => `${d.brand}-${d.category}`);

                circles.exit()
                    .transition()
                    .duration(500)
                    .attr("r", 0)
                    .remove();

                circles.enter()
                    .append("circle")
                    .attr("class", "scatter-circle")
                    .attr("cx", d => x(d.count))
                    .attr("cy", d => y(d.median))
                    .attr("r", 0)
                    .attr("fill", d => brandColors[d.brand])
                    .attr("opacity", 0.7)
                    .attr("stroke", "#fff")
                    .attr("stroke-width", 2)
                    .merge(circles)
                    .on("mouseover", function(event, d) {
                        d3.select(this).attr("opacity", 1).attr("stroke-width", 3);
                        tooltip.style("opacity", 1)
                            .html(`<strong>${d.brand} ${d.category}</strong><br>
                                   Count: ${d.count.toLocaleString()}<br>
                                   Median: $${d.median}<br>
                                   Mean: $${d.mean.toFixed(2)}`)
                            .style("left", (event.pageX + 10) + "px")
                            .style("top", (event.pageY - 28) + "px");
                    })
                    .on("mouseout", function() {
                        d3.select(this).attr("opacity", 0.7).attr("stroke-width", 2);
                        tooltip.style("opacity", 0);
                    })
                    .transition()
                    .duration(500)
                    .attr("cx", d => x(d.count))
                    .attr("cy", d => y(d.median))
                    .attr("r", d => sizeScale(d.count));
            }

            // Add legend
            const legendData = ["Coach", "Gucci", "Hermès"];
            const legend = svg.append("g")
                .attr("transform", `translate(${width - 80}, 20)`);

            legend.selectAll("circle")
                .data(legendData)
                .join("circle")
                .attr("cx", 0)
                .attr("cy", (d, i) => i * 30)
                .attr("r", 8)
                .attr("fill", d => brandColors[d])
                .attr("opacity", 0.7);

            legend.selectAll("text")
                .data(legendData)
                .join("text")
                .attr("x", 20)
                .attr("y", (d, i) => i * 30)
                .attr("dy", "0.35em")
                .style("font-size", "12px")
                .text(d => d);

            updateScatter("all");

            // Category filter buttons
            d3.selectAll(".category-filter").on("click", function() {
                d3.selectAll(".category-filter").classed("active", false);
                d3.select(this).classed("active", true);
                const category = d3.select(this).attr("data-category");
                updateScatter(category);
            });
        }

        // VISUALIZATION 5: Force-Directed Network
        function createNetworkChart() {
            const width = 900;
            const height = 700;

            const svg = d3.select("#network-chart")
                .append("svg")
                .attr("width", width)
                .attr("height", height);

            // Create network data
            const nodes = [
                {id: "Luxury Market", group: 0, size: 40},
                {id: "Gucci", group: 1, size: 30},
                {id: "Coach", group: 2, size: 25},
                {id: "Hermès", group: 3, size: 30},
                {id: "Accessories", group: 4, size: 20},
                {id: "Apparel", group: 4, size: 20},
                {id: "Shoes", group: 4, size: 20},
                {id: "Disney x Gucci", group: 1, size: 15},
                {id: "The North Face x Gucci", group: 1, size: 15},
                {id: "North America", group: 5, size: 18},
                {id: "Asia-Pacific", group: 5, size: 18},
                {id: "Europe", group: 5, size: 18}
            ];

            const links = [
                {source: "Luxury Market", target: "Gucci", value: 10},
                {source: "Luxury Market", target: "Coach", value: 8},
                {source: "Luxury Market", target: "Hermès", value: 10},
                {source: "Gucci", target: "Accessories", value: 5},
                {source: "Gucci", target: "Apparel", value: 5},
                {source: "Gucci", target: "Shoes", value: 5},
                {source: "Coach", target: "Accessories", value: 5},
                {source: "Coach", target: "Apparel", value: 5},
                {source: "Coach", target: "Shoes", value: 5},
                {source: "Hermès", target: "Accessories", value: 5},
                {source: "Hermès", target: "Apparel", value: 5},
                {source: "Hermès", target: "Shoes", value: 5},
                {source: "Gucci", target: "Disney x Gucci", value: 3},
                {source: "Gucci", target: "The North Face x Gucci", value: 3},
                {source: "Gucci", target: "North America", value: 4},
                {source: "Gucci", target: "Asia-Pacific", value: 6},
                {source: "Gucci", target: "Europe", value: 5},
                {source: "Coach", target: "North America", value: 6},
                {source: "Coach", target: "Asia-Pacific", value: 4},
                {source: "Hermès", target: "Asia-Pacific", value: 6},
                {source: "Hermès", target: "Europe", value: 5}
            ];

            const colorScale = d3.scaleOrdinal()
                .domain([0, 1, 2, 3, 4, 5])
                .range(["#333", brandColors.Gucci, brandColors.Coach, brandColors.Hermès, "#999", "#666"]);

            const simulation = d3.forceSimulation(nodes)
                .force("link", d3.forceLink(links).id(d => d.id).distance(100))
                .force("charge", d3.forceManyBody().strength(-300))
                .force("center", d3.forceCenter(width / 2, height / 2))
                .force("collision", d3.forceCollide().radius(d => d.size + 5));

            const link = svg.append("g")
                .selectAll("line")
                .data(links)
                .join("line")
                .attr("stroke", "#999")
                .attr("stroke-opacity", 0.6)
                .attr("stroke-width", d => Math.sqrt(d.value));

            const node = svg.append("g")
                .selectAll("circle")
                .data(nodes)
                .join("circle")
                .attr("r", d => d.size)
                .attr("fill", d => colorScale(d.group))
                .attr("stroke", "#fff")
                .attr("stroke-width", 3)
                .attr("opacity", 0.9)
                .call(drag(simulation))
                .on("mouseover", function(event, d) {
                    d3.select(this).attr("opacity", 1).attr("r", d.size * 1.2);
                    tooltip.style("opacity", 1)
                        .html(`<strong>${d.id}</strong>`)
                        .style("left", (event.pageX + 10) + "px")
                        .style("top", (event.pageY - 28) + "px");
                })
                .on("mouseout", function(event, d) {
                    d3.select(this).attr("opacity", 0.9).attr("r", d.size);
                    tooltip.style("opacity", 0);
                });

            const label = svg.append("g")
                .selectAll("text")
                .data(nodes)
                .join("text")
                .text(d => d.id)
                .attr("font-size", d => d.size / 2)
                .attr("text-anchor", "middle")
                .attr("dy", d => d.size + 15)
                .attr("font-weight", "bold")
                .attr("fill", d => colorScale(d.group));

            simulation.on("tick", () => {
                link
                    .attr("x1", d => d.source.x)
                    .attr("y1", d => d.source.y)
                    .attr("x2", d => d.target.x)
                    .attr("y2", d => d.target.y);

                node
                    .attr("cx", d => d.x)
                    .attr("cy", d => d.y);

                label
                    .attr("x", d => d.x)
                    .attr("y", d => d.y);
            });

            function drag(simulation) {
                function dragstarted(event) {
                    if (!event.active) simulation.alphaTarget(0.3).restart();
                    event.subject.fx = event.subject.x;
                    event.subject.fy = event.subject.y;
                }

                function dragged(event) {
                    event.subject.fx = event.x;
                    event.subject.fy = event.y;
                }

                function dragended(event) {
                    if (!event.active) simulation.alphaTarget(0);
                    event.subject.fx = null;
                    event.subject.fy = null;
                }

                return d3.drag()
                    .on("start", dragstarted)
                    .on("drag", dragged)
                    .on("end", dragended);
            }
        }

        // VISUALIZATION 6: Timeline with Brush
        function createTimelineChart() {
            const margin = {top: 20, right: 80, bottom: 110, left: 60};
            const margin2 = {top: 430, right: 80, bottom: 30, left: 60};
            const width = 1100 - margin.left - margin.right;
            const height = 500 - margin.top - margin.bottom;
            const height2 = 500 - margin2.top - margin2.bottom;

            const svg = d3.select("#timeline-chart")
                .append("svg")
                .attr("width", width + margin.left + margin.right)
                .attr("height", height + margin.top + margin.bottom + 130);

            const parseTime = d3.timeParse("%Y-%m");
            
            // Parse timeline data
            const timelineData = `2004-01,13,33,2
2004-12,24,48,2
2005-12,31,50,1
2006-12,39,51,2
2007-12,38,47,2
2008-12,34,48,2
2009-12,33,46,3
2010-12,35,45,3
2011-12,34,49,5
2012-12,33,46,5
2013-12,28,46,4
2014-12,22,42,4
2015-12,18,41,5
2016-10,10,37,4
2018-04,1,69,4
2018-05,1,45,5
2019-12,10,<1,<1
2020-05,15,40,<1
2020-07,18,59,2
2020-12,30,65,1
2021-06,18,41,6
2021-09,18,76,11
2021-12,38,100,17
2022-01,27,82,17
2022-07,24,76,22
2022-12,35,76,24
2023-06,25,63,25
2023-12,41,71,29
2024-05,35,58,28
2024-12,68,70,42
2025-01,43,56,32
2025-06,40,51,33
2025-11,53,50,29`.split('\n').map(line => {
                const [date, coach, gucci, hermes] = line.split(',');
                return {
                    date: parseTime(date),
                    Coach: +coach,
                    Gucci: +gucci,
                    Hermès: Math.max(+hermes.replace('<', ''), 0)
                };
            });

            const x = d3.scaleTime().range([0, width]);
            const x2 = d3.scaleTime().range([0, width]);
            const y = d3.scaleLinear().range([height, 0]);
            const y2 = d3.scaleLinear().range([height2, 0]);

            const xAxis = d3.axisBottom(x);
            const xAxis2 = d3.axisBottom(x2);
            const yAxis = d3.axisLeft(y);

            const brush = d3.brushX()
                .extent([[0, 0], [width, height2]])
                .on("brush end", brushed);

            const line = d3.line()
                .x(d => x(d.date))
                .y(d => y(d.value));

            const line2 = d3.line()
                .x(d => x2(d.date))
                .y(d => y2(d.value));

            const clip = svg.append("defs").append("clipPath")
                .attr("id", "clip")
                .append("rect")
                .attr("width", width)
                .attr("height", height);

            const focus = svg.append("g")
                .attr("class", "focus")
                .attr("transform", `translate(${margin.left},${margin.top})`);

            const context = svg.append("g")
                .attr("class", "context")
                .attr("transform", `translate(${margin2.left},${margin2.top})`);

            x.domain(d3.extent(timelineData, d => d.date));
            y.domain([0, d3.max(timelineData, d => Math.max(d.Coach, d.Gucci, d.Hermès)) + 10]);
            x2.domain(x.domain());
            y2.domain(y.domain());

            const brands = ["Coach", "Gucci", "Hermès"];
            const brandLines = brands.map(brand => ({
                brand: brand,
                values: timelineData.map(d => ({date: d.date, value: d[brand]}))
            }));

            // Focus chart
            focus.append("g")
                .attr("class", "axis axis--x")
                .attr("transform", `translate(0,${height})`)
                .call(xAxis);

            focus.append("g")
                .attr("class", "axis axis--y")
                .call(yAxis)
                .append("text")
                .attr("transform", "rotate(-90)")
                .attr("y", 6)
                .attr("dy", "0.71em")
                .attr("fill", "#000")
                .text("Search Interest");

            focus.selectAll(".line")
                .data(brandLines)
                .join("path")
                .attr("class", "line")
                .attr("clip-path", "url(#clip)")
                .attr("fill", "none")
                .attr("stroke", d => brandColors[d.brand])
                .attr("stroke-width", 3)
                .attr("d", d => line(d.values));

            // Add interactive points
            focus.selectAll(".brand-points")
                .data(brandLines)
                .join("g")
                .attr("class", "brand-points")
                .attr("clip-path", "url(#clip)")
                .selectAll("circle")
                .data(d => d.values.map(v => ({brand: d.brand, ...v})))
                .join("circle")
                .attr("cx", d => x(d.date))
                .attr("cy", d => y(d.value))
                .attr("r", 4)
                .attr("fill", d => brandColors[d.brand])
                .attr("opacity", 0.7)
                .on("mouseover", function(event, d) {
                    d3.select(this).attr("r", 7).attr("opacity", 1);
                    const dateStr = d3.timeFormat("%B %Y")(d.date);
                    tooltip.style("opacity", 1)
                        .html(`<strong>${d.brand}</strong><br>${dateStr}<br>Interest: ${d.value}`)
                        .style("left", (event.pageX + 10) + "px")
                        .style("top", (event.pageY - 28) + "px");
                })
                .on("mouseout", function() {
                    d3.select(this).attr("r", 4).attr("opacity", 0.7);
                    tooltip.style("opacity", 0);
                });

            // Context chart (brush area)
            context.append("g")
                .attr("class", "axis axis--x")
                .attr("transform", `translate(0,${height2})`)
                .call(xAxis2);

            context.selectAll(".line")
                .data(brandLines)
                .join("path")
                .attr("class", "line")
                .attr("fill", "none")
                .attr("stroke", d => brandColors[d.brand])
                .attr("stroke-width", 2)
                .attr("d", d => line2(d.values));

            context.append("g")
                .attr("class", "brush")
                .call(brush)
                .call(brush.move, x.range());

            function brushed(event) {
                if (event.selection) {
                    const s = event.selection.map(x2.invert, x2);
                    x.domain(s);
                    focus.selectAll(".line").attr("d", d => line(d.values));
                    focus.selectAll("circle")
                        .attr("cx", d => x(d.date))
                        .attr("cy", d => y(d.value));
                    focus.select(".axis--x").call(xAxis);
                }
            }

            // Add legend
            const legend = focus.append("g")
                .attr("transform", `translate(${width - 100}, 20)`);

            brands.forEach((brand, i) => {
                const legendRow = legend.append("g")
                    .attr("transform", `translate(0, ${i * 25})`);

                legendRow.append("rect")
                    .attr("width", 20)
                    .attr("height", 3)
                    .attr("fill", brandColors[brand]);

                legendRow.append("text")
                    .attr("x", 30)
                    .attr("y", 3)
                    .attr("text-anchor", "start")
                    .style("font-size", "12px")
                    .text(brand);
            });

            // Add annotation for key events
            const annotations = [
                {date: parseTime("2018-04"), label: "Gucci Peak", y: 69},
                {date: parseTime("2021-12"), label: "Gucci at 100", y: 100},
                {date: parseTime("2024-12"), label: "Coach Surge", y: 68}
            ];

            annotations.forEach(ann => {
                focus.append("line")
                    .attr("x1", x(ann.date))
                    .attr("x2", x(ann.date))
                    .attr("y1", y(ann.y))
                    .attr("y2", y(ann.y) - 30)
                    .attr("stroke", "#666")
                    .attr("stroke-dasharray", "3,3");

                focus.append("text")
                    .attr("x", x(ann.date))
                    .attr("y", y(ann.y) - 35)
                    .attr("text-anchor", "middle")
                    .style("font-size", "10px")
                    .style("font-weight", "bold")
                    .style("fill", "#666")
                    .text(ann.label);
            });
        }

        // VISUALIZATION 7: Geographic Map
        function createGeoChart() {
            const width = 1100;
            const height = 700;

            const svg = d3.select("#geo-chart")
                .append("svg")
                .attr("width", width)
                .attr("height", height);

            // Parse geo data - showing key countries
            const geoData = [
                {country: "United States", Coach: 43, Gucci: 49, Hermès: 8, lat: 37.0902, lon: -95.7129},
                {country: "Canada", Coach: 41, Gucci: 50, Hermès: 9, lat: 56.1304, lon: -106.3468},
                {country: "Mexico", Coach: 42, Gucci: 52, Hermès: 6, lat: 23.6345, lon: -102.5528},
                {country: "United Kingdom", Coach: 14, Gucci: 75, Hermès: 11, lat: 55.3781, lon: -3.4360},
                {country: "France", Coach: 6, Gucci: 62, Hermès: 32, lat: 46.2276, lon: 2.2137},
                {country: "Germany", Coach: 8, Gucci: 73, Hermès: 19, lat: 51.1657, lon: 10.4515},
                {country: "Italy", Coach: 1, Gucci: 86, Hermès: 13, lat: 41.8719, lon: 12.5674},
                {country: "Spain", Coach: 10, Gucci: 71, Hermès: 19, lat: 40.4637, lon: -3.7492},
                {country: "Switzerland", Coach: 5, Gucci: 69, Hermès: 26, lat: 46.8182, lon: 8.2275},
                {country: "Japan", Coach: 29, Gucci: 43, Hermès: 28, lat: 36.2048, lon: 138.2529},
                {country: "China", Coach: 15, Gucci: 64, Hermès: 21, lat: 35.8617, lon: 104.1954},
                {country: "Hong Kong", Coach: 15, Gucci: 49, Hermès: 36, lat: 22.3193, lon: 114.1694},
                {country: "South Korea", Coach: 10, Gucci: 57, Hermès: 33, lat: 35.9078, lon: 127.7669},
                {country: "Singapore", Coach: 29, Gucci: 44, Hermès: 27, lat: 1.3521, lon: 103.8198},
                {country: "Australia", Coach: 21, Gucci: 65, Hermès: 14, lat: -25.2744, lon: 133.7751},
                {country: "Brazil", Coach: 6, Gucci: 83, Hermès: 11, lat: -14.2350, lon: -51.9253},
                {country: "India", Coach: 15, Gucci: 78, Hermès: 7, lat: 20.5937, lon: 78.9629},
                {country: "UAE", Coach: 13, Gucci: 55, Hermès: 32, lat: 23.4241, lon: 53.8478},
                {country: "Russia", Coach: 10, Gucci: 67, Hermès: 23, lat: 61.5240, lon: 105.3188},
                {country: "Thailand", Coach: 45, Gucci: 44, Hermès: 11, lat: 15.8700, lon: 100.9925},
                {country: "Indonesia", Coach: 31, Gucci: 45, Hermès: 24, lat: -0.7893, lon: 113.9213},
                {country: "Philippines", Coach: 37, Gucci: 43, Hermès: 20, lat: 12.8797, lon: 121.7740},
                {country: "Taiwan", Coach: 34, Gucci: 45, Hermès: 21, lat: 23.6978, lon: 120.9605},
                {country: "Malaysia", Coach: 43, Gucci: 44, Hermès: 13, lat: 4.2105, lon: 101.9758}
            ];

            // Add dominant brand to each country
            geoData.forEach(d => {
                const max = Math.max(d.Coach, d.Gucci, d.Hermès);
                if (max === d.Coach) d.dominant = "Coach";
                else if (max === d.Gucci) d.dominant = "Gucci";
                else d.dominant = "Hermès";
            });

            // Create projection
            const projection = d3.geoMercator()
                .scale(140)
                .translate([width / 2, height / 1.5]);

            // Draw world map background
            const mapGroup = svg.append("g");

            // Simple continents representation
            const continents = [
                {name: "North America", x: 180, y: 180, width: 280, height: 200, rx: 30},
                {name: "South America", x: 270, y: 400, width: 120, height: 200, rx: 20},
                {name: "Europe", x: 500, y: 130, width: 150, height: 140, rx: 20},
                {name: "Africa", x: 510, y: 280, width: 140, height: 180, rx: 25},
                {name: "Asia", x: 680, y: 120, width: 340, height: 240, rx: 35},
                {name: "Australia", x: 850, y: 450, width: 120, height: 80, rx: 15}
            ];

            mapGroup.selectAll(".continent")
                .data(continents)
                .join("rect")
                .attr("class", "continent")
                .attr("x", d => d.x)
                .attr("y", d => d.y)
                .attr("width", d => d.width)
                .attr("height", d => d.height)
                .attr("rx", d => d.rx)
                .attr("fill", "#e8e8e0")
                .attr("stroke", "#ccc")
                .attr("stroke-width", 1);

            // Plot countries as circles
            const circles = svg.selectAll(".country-circle")
                .data(geoData)
                .join("g")
                .attr("class", "country-circle");

            // Position based on lat/lon
            circles.each(function(d) {
                const [x, y] = projection([d.lon, d.lat]);
                d.x = x;
                d.y = y;
            });

            // Draw pie charts for each country
            const pie = d3.pie()
                .value(d => d.value)
                .sort(null);

            const arcGenerator = d3.arc()
                .innerRadius(0)
                .outerRadius(d => Math.sqrt(d.data.total) * 0.8);

            circles.each(function(d) {
                const g = d3.select(this);
                const total = d.Coach + d.Gucci + d.Hermès;
                
                const pieData = pie([
                    {brand: "Coach", value: d.Coach, total: total},
                    {brand: "Gucci", value: d.Gucci, total: total},
                    {brand: "Hermès", value: d.Hermès, total: total}
                ]);

                g.selectAll("path")
                    .data(pieData)
                    .join("path")
                    .attr("transform", `translate(${d.x},${d.y})`)
                    .attr("d", arcGenerator)
                    .attr("fill", seg => brandColors[seg.data.brand])
                    .attr("stroke", "#fff")
                    .attr("stroke-width", 1)
                    .attr("opacity", 0.85);

                // Add border circle
                g.append("circle")
                    .attr("cx", d.x)
                    .attr("cy", d.y)
                    .attr("r", Math.sqrt(total) * 0.8)
                    .attr("fill", "none")
                    .attr("stroke", brandColors[d.dominant])
                    .attr("stroke-width", 2)
                    .attr("opacity", 0.6);
            });

            // Add country labels and interactivity
            circles.append("text")
                .attr("x", d => d.x)
                .attr("y", d => d.y + Math.sqrt(d.Coach + d.Gucci + d.Hermès) * 0.8 + 12)
                .attr("text-anchor", "middle")
                .style("font-size", "9px")
                .style("font-weight", "bold")
                .style("fill", "#333")
                .style("pointer-events", "none")
                .text(d => d.country);

            circles.on("mouseover", function(event, d) {
                d3.select(this).selectAll("path").attr("opacity", 1);
                tooltip.style("opacity", 1)
                    .html(`<strong>${d.country}</strong><br>
                           Coach: ${d.Coach}%<br>
                           Gucci: ${d.Gucci}%<br>
                           Hermès: ${d.Hermès}%<br>
                           <em>Dominant: ${d.dominant}</em>`)
                    .style("left", (event.pageX + 10) + "px")
                    .style("top", (event.pageY - 28) + "px");
            })
            .on("mouseout", function() {
                d3.select(this).selectAll("path").attr("opacity", 0.85);
                tooltip.style("opacity", 0);
            });

            // Add title legend
            const legendGroup = svg.append("g")
                .attr("transform", `translate(50, 30)`);

            legendGroup.append("text")
                .attr("x", 0)
                .attr("y", 0)
                .style("font-size", "14px")
                .style("font-weight", "bold")
                .text("Market Share by Country (Google Search Interest)");

            // Brand legend
            const brands = ["Coach", "Gucci", "Hermès"];
            const brandLegend = svg.append("g")
                .attr("transform", `translate(${width - 150}, 30)`);

            brands.forEach((brand, i) => {
                const row = brandLegend.append("g")
                    .attr("transform", `translate(0, ${i * 25})`);

                row.append("circle")
                    .attr("r", 8)
                    .attr("fill", brandColors[brand])
                    .attr("opacity", 0.85);

                row.append("text")
                    .attr("x", 15)
                    .attr("y", 4)
                    .style("font-size", "12px")
                    .text(brand);
            });

            // Add note about circle size
            svg.append("text")
                .attr("x", 50)
                .attr("y", height - 20)
                .style("font-size", "11px")
                .style("font-style", "italic")
                .style("fill", "#666")
                .text("Note: Circle size represents total search volume. Pie slices show market share per brand.");
        }

        // VISUALIZATION 8: Hermès Violin Plot
        function createHermesViolinChart() {
            const margin = {top: 40, right: 60, bottom: 80, left: 100};
            const width = 1000 - margin.left - margin.right;
            const height = 600 - margin.top - margin.bottom;

            const svg = d3.select("#hermes-violin-chart")
                .append("svg")
                .attr("width", width + margin.left + margin.right)
                .attr("height", height + margin.top + margin.bottom)
                .append("g")
                .attr("transform", `translate(${margin.left},${margin.top})`);

            // Hermès data with quartile info
            const hermesData = [
                {
                    category: "Accessories",
                    count: 12431,
                    mean: 621.87,
                    median: 376.0,
                    p25: 208.16,
                    p75: 643.39,
                    min: 50,  // estimated
                    max: 2500 // estimated based on luxury accessories
                },
                {
                    category: "Apparel",
                    count: 1680,
                    mean: 1217.1,
                    median: 639.0,
                    p25: 367.16,
                    p75: 1249.36,
                    min: 150,
                    max: 3500
                },
                {
                    category: "Shoes",
                    count: 4605,
                    mean: 1016.97,
                    median: 897.89,
                    p25: 598.59,
                    p75: 1325.38,
                    min: 300,
                    max: 2200
                }
            ];

            const x = d3.scaleBand()
                .domain(hermesData.map(d => d.category))
                .range([0, width])
                .padding(0.2);

            const y = d3.scaleLinear()
                .domain([0, 3600])
                .range([height, 0]);

            // Draw axes
            svg.append("g")
                .attr("transform", `translate(0,${height})`)
                .call(d3.axisBottom(x))
                .selectAll("text")
                .style("font-size", "14px")
                .style("font-weight", "bold");

            svg.append("g")
                .call(d3.axisLeft(y).tickFormat(d => `$${d}`))
                .style("font-size", "12px");

            svg.append("text")
                .attr("transform", "rotate(-90)")
                .attr("x", -height / 2)
                .attr("y", -70)
                .attr("text-anchor", "middle")
                .style("font-size", "16px")
                .style("font-weight", "bold")
                .text("Resale Price (USD)");

            // Create violin shapes for each category
            hermesData.forEach((d, i) => {
                const categoryX = x(d.category);
                const violinWidth = x.bandwidth();

                // Create gradient
                const gradient = svg.append("defs")
                    .append("linearGradient")
                    .attr("id", `violin-gradient-${i}`)
                    .attr("x1", "0%")
                    .attr("y1", "0%")
                    .attr("x2", "0%")
                    .attr("y2", "100%");

                gradient.append("stop")
                    .attr("offset", "0%")
                    .attr("stop-color", "#2c2c2c")
                    .attr("stop-opacity", 0.9);

                gradient.append("stop")
                    .attr("offset", "100%")
                    .attr("stop-color", "#8b8b8b")
                    .attr("stop-opacity", 0.7);

                // Generate violin shape (simulated distribution)
                const points = [];
                const steps = 50;
                for (let j = 0; j <= steps; j++) {
                    const price = d.min + (d.max - d.min) * (j / steps);
                    let density = 0;
                    
                    // Simulate density based on quartiles
                    if (price < d.p25) {
                        density = 0.3 + 0.4 * (price - d.min) / (d.p25 - d.min);
                    } else if (price < d.median) {
                        density = 0.7 + 0.3 * (price - d.p25) / (d.median - d.p25);
                    } else if (price < d.p75) {
                        density = 1.0 - 0.2 * (price - d.median) / (d.p75 - d.median);
                    } else {
                        density = 0.8 - 0.6 * (price - d.p75) / (d.max - d.p75);
                    }
                    
                    density = Math.max(0.1, density);
                    points.push({price: price, density: density});
                }

                // Create path for violin
                const violinPath = d3.area()
                    .x0(p => categoryX + violinWidth / 2 - (violinWidth / 2) * p.density)
                    .x1(p => categoryX + violinWidth / 2 + (violinWidth / 2) * p.density)
                    .y(p => y(p.price))
                    .curve(d3.curveCatmullRom);

                svg.append("path")
                    .datum(points)
                    .attr("d", violinPath)
                    .attr("fill", `url(#violin-gradient-${i})`)
                    .attr("stroke", "#2c2c2c")
                    .attr("stroke-width", 2)
                    .attr("opacity", 0.8);

                // Draw box plot overlay
                const boxWidth = 30;
                const boxX = categoryX + violinWidth / 2 - boxWidth / 2;

                // IQR box (25th to 75th percentile)
                svg.append("rect")
                    .attr("x", boxX)
                    .attr("y", y(d.p75))
                    .attr("width", boxWidth)
                    .attr("height", y(d.p25) - y(d.p75))
                    .attr("fill", "#d4af37")
                    .attr("stroke", "#2c2c2c")
                    .attr("stroke-width", 2)
                    .attr("opacity", 0.9);

                // Median line
                svg.append("line")
                    .attr("x1", boxX)
                    .attr("x2", boxX + boxWidth)
                    .attr("y1", y(d.median))
                    .attr("y2", y(d.median))
                    .attr("stroke", "#fff")
                    .attr("stroke-width", 3);

                // Mean point
                svg.append("circle")
                    .attr("cx", categoryX + violinWidth / 2)
                    .attr("cy", y(d.mean))
                    .attr("r", 6)
                    .attr("fill", "#ff6b6b")
                    .attr("stroke", "#fff")
                    .attr("stroke-width", 2);

                // Whiskers
                svg.append("line")
                    .attr("x1", categoryX + violinWidth / 2)
                    .attr("x2", categoryX + violinWidth / 2)
                    .attr("y1", y(d.p75))
                    .attr("y2", y(d.max))
                    .attr("stroke", "#2c2c2c")
                    .attr("stroke-width", 1.5)
                    .attr("stroke-dasharray", "4,4");

                svg.append("line")
                    .attr("x1", categoryX + violinWidth / 2)
                    .attr("x2", categoryX + violinWidth / 2)
                    .attr("y1", y(d.p25))
                    .attr("y2", y(d.min))
                    .attr("stroke", "#2c2c2c")
                    .attr("stroke-width", 1.5)
                    .attr("stroke-dasharray", "4,4");

                // Add interactive overlay
                svg.append("rect")
                    .attr("x", categoryX)
                    .attr("y", 0)
                    .attr("width", violinWidth)
                    .attr("height", height)
                    .attr("fill", "transparent")
                    .style("cursor", "pointer")
                    .on("mouseover", function(event) {
                        tooltip.style("opacity", 1)
                            .html(`<strong>Hermès ${d.category}</strong><br>
                                   Items Sold: ${d.count.toLocaleString()}<br>
                                   <br><strong>Price Statistics:</strong><br>
                                   Maximum: $${d.max.toFixed(2)}<br>
                                   75th %ile: $${d.p75.toFixed(2)}<br>
                                   Median: $${d.median.toFixed(2)}<br>
                                   Mean: <span style="color: #ff6b6b">$${d.mean.toFixed(2)}</span><br>
                                   25th %ile: $${d.p25.toFixed(2)}<br>
                                   Minimum: $${d.min.toFixed(2)}`)
                            .style("left", (event.pageX + 10) + "px")
                            .style("top", (event.pageY - 28) + "px");
                    })
                    .on("mouseout", function() {
                        tooltip.style("opacity", 0);
                    });

                // Add count label
                svg.append("text")
                    .attr("x", categoryX + violinWidth / 2)
                    .attr("y", height + 40)
                    .attr("text-anchor", "middle")
                    .style("font-size", "11px")
                    .style("fill", "#666")
                    .text(`n = ${d.count.toLocaleString()}`);
            });

            // Add legend
            const legend = svg.append("g")
                .attr("transform", `translate(${width - 150}, 20)`);

            legend.append("rect")
                .attr("width", 30)
                .attr("height", 15)
                .attr("fill", "#d4af37")
                .attr("opacity", 0.9);

            legend.append("text")
                .attr("x", 40)
                .attr("y", 12)
                .style("font-size", "12px")
                .text("IQR (25-75%)");

            legend.append("line")
                .attr("x1", 0)
                .attr("x2", 30)
                .attr("y1", 35)
                .attr("y2", 35)
                .attr("stroke", "#fff")
                .attr("stroke-width", 3);

            legend.append("text")
                .attr("x", 40)
                .attr("y", 38)
                .style("font-size", "12px")
                .text("Median");

            legend.append("circle")
                .attr("cx", 15)
                .attr("cy", 55)
                .attr("r", 6)
                .attr("fill", "#ff6b6b")
                .attr("stroke", "#fff")
                .attr("stroke-width", 2);

            legend.append("text")
                .attr("x", 40)
                .attr("y", 58)
                .style("font-size", "12px")
                .text("Mean");
        }

        // VISUALIZATION 9: Hermès Waterfall/Sankey
        function createHermesWaterfallChart() {
            const margin = {top: 40, right: 150, bottom: 60, left: 150};
            const width = 1000 - margin.left - margin.right;
            const height = 700 - margin.top - margin.bottom;

            const svg = d3.select("#hermes-waterfall-chart")
                .append("svg")
                .attr("width", width + margin.left + margin.right)
                .attr("height", height + margin.top + margin.bottom)
                .append("g")
                .attr("transform", `translate(${margin.left},${margin.top})`);

            // Hermès data
            const categories = [
                {name: "Accessories", count: 12431, p25: 208.16, median: 376.0, p75: 643.39},
                {name: "Apparel", count: 1680, p25: 367.16, median: 639.0, p75: 1249.36},
                {name: "Shoes", count: 4605, p25: 598.59, median: 897.89, p75: 1325.38}
            ];

            const priceRanges = [
                {name: "Entry Level", label: "< 25th %ile", color: "#a8dadc"},
                {name: "Mid-Range", label: "25th - Median", color: "#457b9d"},
                {name: "Premium", label: "Median - 75th", color: "#d4af37"},
                {name: "Ultra-Premium", label: "> 75th %ile", color: "#2c2c2c"}
            ];

            // Calculate flows
            const flows = [];
            categories.forEach((cat, i) => {
                const yStart = (height / categories.length) * i + 50;
                const rangeHeight = (height / categories.length) * 0.6;

                // Distribute count across price ranges (25% each quartile)
                const quarter = cat.count / 4;
                
                priceRanges.forEach((range, j) => {
                    flows.push({
                        source: cat.name,
                        target: range.name,
                        value: quarter,
                        sourceY: yStart,
                        targetX: width,
                        targetY: (height / priceRanges.length) * j + 50,
                        color: range.color,
                        price: j === 0 ? `$${cat.p25.toFixed(0)}` : 
                               j === 1 ? `$${cat.median.toFixed(0)}` :
                               j === 2 ? `$${cat.p75.toFixed(0)}` :
                               `$${(cat.p75 * 1.5).toFixed(0)}`
                    });
                });
            });

            // Y scale for sources
            const ySource = d3.scaleBand()
                .domain(categories.map(d => d.name))
                .range([0, height])
                .padding(0.3);

            // Y scale for targets
            const yTarget = d3.scaleBand()
                .domain(priceRanges.map(d => d.name))
                .range([0, height])
                .padding(0.2);

            const sizeScale = d3.scaleLinear()
                .domain([0, d3.max(categories, d => d.count / 4)])
                .range([0, 120]);

            // Draw source nodes (categories)
            const sourceNodes = svg.selectAll(".source-node")
                .data(categories)
                .join("g")
                .attr("class", "source-node")
                .attr("transform", d => `translate(0, ${ySource(d.name)})`);

            sourceNodes.append("rect")
                .attr("width", 120)
                .attr("height", ySource.bandwidth())
                .attr("fill", "#2c2c2c")
                .attr("rx", 5)
                .attr("opacity", 0.9);

            sourceNodes.append("text")
                .attr("x", 60)
                .attr("y", ySource.bandwidth() / 2 - 10)
                .attr("text-anchor", "middle")
                .attr("fill", "white")
                .style("font-weight", "bold")
                .style("font-size", "14px")
                .text(d => d.name);

            sourceNodes.append("text")
                .attr("x", 60)
                .attr("y", ySource.bandwidth() / 2 + 10)
                .attr("text-anchor", "middle")
                .attr("fill", "#d4af37")
                .style("font-size", "11px")
                .text(d => `${d.count.toLocaleString()} items`);

            // Draw target nodes (price ranges)
            const targetNodes = svg.selectAll(".target-node")
                .data(priceRanges)
                .join("g")
                .attr("class", "target-node")
                .attr("transform", d => `translate(${width - 120}, ${yTarget(d.name)})`);

            targetNodes.append("rect")
                .attr("width", 120)
                .attr("height", yTarget.bandwidth())
                .attr("fill", d => d.color)
                .attr("rx", 5)
                .attr("opacity", 0.9);

            targetNodes.append("text")
                .attr("x", 60)
                .attr("y", yTarget.bandwidth() / 2 - 5)
                .attr("text-anchor", "middle")
                .attr("fill", "white")
                .style("font-weight", "bold")
                .style("font-size", "13px")
                .text(d => d.name);

            targetNodes.append("text")
                .attr("x", 60)
                .attr("y", yTarget.bandwidth() / 2 + 12)
                .attr("text-anchor", "middle")
                .attr("fill", "white")
                .style("font-size", "10px")
                .text(d => d.label);

            // Draw flows with curved paths
            const linkGen = d3.linkHorizontal()
                .source(d => [120, ySource(d.source) + ySource.bandwidth() / 2])
                .target(d => [width - 120, yTarget(d.target) + yTarget.bandwidth() / 2]);

            const links = svg.selectAll(".flow-link")
                .data(flows)
                .join("path")
                .attr("class", "flow-link")
                .attr("d", linkGen)
                .attr("fill", "none")
                .attr("stroke", d => d.color)
                .attr("stroke-width", d => sizeScale(d.value))
                .attr("opacity", 0)
                .on("mouseover", function(event, d) {
                    d3.select(this).attr("opacity", 0.9).attr("stroke-width", sizeScale(d.value) * 1.2);
                    tooltip.style("opacity", 1)
                        .html(`<strong>${d.source} → ${d.target}</strong><br>
                               ~${Math.round(d.value).toLocaleString()} items<br>
                               Avg Price: ${d.price}`)
                        .style("left", (event.pageX + 10) + "px")
                        .style("top", (event.pageY - 28) + "px");
                })
                .on("mouseout", function(event, d) {
                    d3.select(this).attr("opacity", 0.5).attr("stroke-width", sizeScale(d.value));
                    tooltip.style("opacity", 0);
                });

            // Animation function
            function animateWaterfall() {
                links.attr("opacity", 0)
                    .transition()
                    .duration(2000)
                    .delay((d, i) => i * 100)
                    .attr("opacity", 0.5);
            }

            d3.select("#animate-waterfall").on("click", animateWaterfall);

            // Add title annotations
            svg.append("text")
                .attr("x", 60)
                .attr("y", -20)
                .attr("text-anchor", "middle")
                .style("font-size", "14px")
                .style("font-weight", "bold")
                .style("fill", "#666")
                .text("Categories");

            svg.append("text")
                .attr("x", width - 60)
                .attr("y", -20)
                .attr("text-anchor", "middle")
                .style("font-size", "14px")
                .style("font-weight", "bold")
                .style("fill", "#666")
                .text("Price Tiers");

            // Add insight text
            svg.append("text")
                .attr("x", width / 2)
                .attr("y", height + 40)
                .attr("text-anchor", "middle")
                .style("font-size", "12px")
                .style("font-style", "italic")
                .style("fill", "#666")
                .text("Flow width represents volume of items. Notice how Apparel concentrates in higher price tiers.");

            // Auto-play animation
            setTimeout(animateWaterfall, 500);
        }

        // Visualization 10: Coach Condition Heatmap
        async function createCoachHeatmapChart() {
            const data = await d3.csv("vestiaire-coach.csv");
            
            // Process data: group by category and condition
            const categories = ["T-shirt", "Dress", "Jacket", "Leather jacket", "Trench coat"];
            const conditions = ["Never worn, with tag", "Very good condition", "Good condition", "Fair condition"];
            
            const heatmapData = [];
            categories.forEach(category => {
                conditions.forEach(condition => {
                    const items = data.filter(d => 
                        d.product_type === category && 
                        d.product_condition === condition
                    );
                    if (items.length > 0) {
                        const avgPrice = d3.mean(items, d => +d.price_usd);
                        heatmapData.push({
                            category,
                            condition,
                            price: avgPrice,
                            count: items.length
                        });
                    }
                });
            });

            const margin = {top: 80, right: 100, bottom: 120, left: 150};
            const width = 900 - margin.left - margin.right;
            const height = 500 - margin.top - margin.bottom;

            const svg = d3.select("#coach-heatmap")
                .append("svg")
                .attr("width", width + margin.left + margin.right)
                .attr("height", height + margin.top + margin.bottom)
                .append("g")
                .attr("transform", `translate(${margin.left},${margin.top})`);

            // Scales
            const x = d3.scaleBand()
                .domain(conditions)
                .range([0, width])
                .padding(0.05);

            const y = d3.scaleBand()
                .domain(categories)
                .range([0, height])
                .padding(0.05);

            const colorScale = d3.scaleSequential()
                .domain([0, d3.max(heatmapData, d => d.price)])
                .interpolator(d3.interpolateOrRd);

            // Create cells
            const cells = svg.selectAll("rect")
                .data(heatmapData)
                .enter()
                .append("rect")
                .attr("x", d => x(d.condition))
                .attr("y", d => y(d.category))
                .attr("width", x.bandwidth())
                .attr("height", y.bandwidth())
                .attr("fill", d => colorScale(d.price))
                .attr("stroke", "white")
                .attr("stroke-width", 2)
                .attr("opacity", 0)
                .on("mouseover", function(event, d) {
                    d3.select(this)
                        .attr("stroke", brandColors.Coach)
                        .attr("stroke-width", 4);
                    tooltip.style("opacity", 1)
                        .html(`<strong>${d.category}</strong><br>
                               Condition: ${d.condition}<br>
                               Avg Price: $${d.price.toFixed(2)}<br>
                               Items: ${d.count}`)
                        .style("left", (event.pageX + 10) + "px")
                        .style("top", (event.pageY - 28) + "px");
                })
                .on("mouseout", function() {
                    d3.select(this)
                        .attr("stroke", "white")
                        .attr("stroke-width", 2);
                    tooltip.style("opacity", 0);
                });

            // Animate cells
            cells.transition()
                .duration(1000)
                .delay((d, i) => i * 50)
                .attr("opacity", 1);

            // Add price labels
            svg.selectAll(".price-label")
                .data(heatmapData)
                .enter()
                .append("text")
                .attr("class", "price-label")
                .attr("x", d => x(d.condition) + x.bandwidth() / 2)
                .attr("y", d => y(d.category) + y.bandwidth() / 2)
                .attr("text-anchor", "middle")
                .attr("dy", ".35em")
                .style("font-size", "12px")
                .style("font-weight", "bold")
                .style("fill", d => d.price > 300 ? "white" : "#333")
                .style("opacity", 0)
                .text(d => `$${Math.round(d.price)}`)
                .transition()
                .duration(1000)
                .delay((d, i) => i * 50 + 500)
                .style("opacity", 1);

            // Axes
            svg.append("g")
                .attr("transform", `translate(0,${height})`)
                .call(d3.axisBottom(x))
                .selectAll("text")
                .attr("transform", "rotate(-45)")
                .style("text-anchor", "end")
                .style("font-size", "12px");

            svg.append("g")
                .call(d3.axisLeft(y))
                .selectAll("text")
                .style("font-size", "12px");

            // Color legend
            const legendWidth = 300;
            const legendHeight = 20;
            const legendScale = d3.scaleLinear()
                .domain([0, d3.max(heatmapData, d => d.price)])
                .range([0, legendWidth]);

            const legendSvg = svg.append("g")
                .attr("transform", `translate(${width - legendWidth}, ${height + 70})`);

            const legendGradient = legendSvg.append("defs")
                .append("linearGradient")
                .attr("id", "legend-gradient")
                .attr("x1", "0%")
                .attr("x2", "100%");

            legendGradient.selectAll("stop")
                .data(d3.range(0, 1.1, 0.1))
                .enter()
                .append("stop")
                .attr("offset", d => `${d * 100}%`)
                .attr("stop-color", d => colorScale(d * d3.max(heatmapData, dt => dt.price)));

            legendSvg.append("rect")
                .attr("width", legendWidth)
                .attr("height", legendHeight)
                .style("fill", "url(#legend-gradient)");

            legendSvg.append("text")
                .attr("x", 0)
                .attr("y", -5)
                .style("font-size", "11px")
                .style("fill", "#666")
                .text("$0");

            legendSvg.append("text")
                .attr("x", legendWidth)
                .attr("y", -5)
                .attr("text-anchor", "end")
                .style("font-size", "11px")
                .style("fill", "#666")
                .text(`$${Math.round(d3.max(heatmapData, d => d.price))}`);

            // Insight annotation
            svg.append("text")
                .attr("x", width / 2)
                .attr("y", height + 100)
                .attr("text-anchor", "middle")
                .style("font-size", "13px")
                .style("font-style", "italic")
                .style("fill", "#666")
                .text("Higher condition grades command premium prices across all Coach categories");
        }

        // Visualization 11: Coach Seller Performance
        async function createCoachSellerChart() {
            const data = await d3.csv("vestiaire-coach.csv");
            
            // Filter and process data
            const sellerData = data.map(d => ({
                badge: d.seller_badge,
                products_sold: +d.seller_products_sold,
                price: +d.price_usd,
                pass_rate: +d.seller_pass_rate,
                rank: +d.seller_community_rank,
                category: d.product_type
            })).filter(d => d.products_sold > 0 && d.price > 0);

            const margin = {top: 40, right: 150, bottom: 80, left: 80};
            const width = 900 - margin.left - margin.right;
            const height = 550 - margin.top - margin.bottom;

            const svg = d3.select("#coach-sellers")
                .append("svg")
                .attr("width", width + margin.left + margin.right)
                .attr("height", height + margin.top + margin.bottom)
                .append("g")
                .attr("transform", `translate(${margin.left},${margin.top})`);

            // Scales
            const x = d3.scaleLog()
                .domain([1, d3.max(sellerData, d => d.products_sold)])
                .range([0, width])
                .nice();

            const y = d3.scaleLinear()
                .domain([0, d3.max(sellerData, d => d.price)])
                .range([height, 0])
                .nice();

            const sizeScale = d3.scaleSqrt()
                .domain([0, d3.max(sellerData, d => d.pass_rate)])
                .range([3, 15]);

            const badgeColors = {
                'Expert': '#d4af37',
                'Trusted': '#4a9eff',
                'Common': '#999'
            };

            // Add grid
            svg.append("g")
                .attr("class", "grid")
                .attr("opacity", 0.1)
                .call(d3.axisLeft(y).tickSize(-width).tickFormat(""));

            // Create circles
            let currentFilter = "all";
            const circles = svg.selectAll("circle")
                .data(sellerData)
                .enter()
                .append("circle")
                .attr("cx", d => x(d.products_sold))
                .attr("cy", d => y(d.price))
                .attr("r", d => sizeScale(d.pass_rate))
                .attr("fill", d => badgeColors[d.badge] || "#999")
                .attr("opacity", 0.6)
                .attr("stroke", "#fff")
                .attr("stroke-width", 1.5)
                .on("mouseover", function(event, d) {
                    d3.select(this)
                        .attr("opacity", 1)
                        .attr("stroke", brandColors.Coach)
                        .attr("stroke-width", 3);
                    tooltip.style("opacity", 1)
                        .html(`<strong>${d.badge} Seller</strong><br>
                               Products Sold: ${d.products_sold}<br>
                               Price: $${d.price.toFixed(2)}<br>
                               Pass Rate: ${d.pass_rate}%<br>
                               Rank: ${d.rank}<br>
                               Category: ${d.category}`)
                        .style("left", (event.pageX + 10) + "px")
                        .style("top", (event.pageY - 28) + "px");
                })
                .on("mouseout", function() {
                    d3.select(this)
                        .attr("opacity", 0.6)
                        .attr("stroke", "#fff")
                        .attr("stroke-width", 1.5);
                    tooltip.style("opacity", 0);
                });

            // Axes
            svg.append("g")
                .attr("transform", `translate(0,${height})`)
                .call(d3.axisBottom(x).tickFormat(d => d))
                .selectAll("text")
                .style("font-size", "12px");

            svg.append("g")
                .call(d3.axisLeft(y).tickFormat(d => `$${d}`))
                .selectAll("text")
                .style("font-size", "12px");

            // Axis labels
            svg.append("text")
                .attr("x", width / 2)
                .attr("y", height + 50)
                .attr("text-anchor", "middle")
                .style("font-size", "14px")
                .style("font-weight", "bold")
                .style("fill", "#666")
                .text("Products Sold (log scale)");

            svg.append("text")
                .attr("transform", "rotate(-90)")
                .attr("x", -height / 2)
                .attr("y", -50)
                .attr("text-anchor", "middle")
                .style("font-size", "14px")
                .style("font-weight", "bold")
                .style("fill", "#666")
                .text("Price (USD)");

            // Legend
            const legend = svg.append("g")
                .attr("transform", `translate(${width + 20}, 20)`);

            Object.entries(badgeColors).forEach(([badge, color], i) => {
                const legendRow = legend.append("g")
                    .attr("transform", `translate(0, ${i * 30})`);

                legendRow.append("circle")
                    .attr("r", 8)
                    .attr("fill", color)
                    .attr("opacity", 0.6);

                legendRow.append("text")
                    .attr("x", 15)
                    .attr("y", 5)
                    .style("font-size", "13px")
                    .text(badge);
            });

            // Size legend
            legend.append("text")
                .attr("x", 0)
                .attr("y", 110)
                .style("font-size", "12px")
                .style("font-weight", "bold")
                .style("fill", "#666")
                .text("Pass Rate");

            [20, 50, 80, 100].forEach((rate, i) => {
                legend.append("circle")
                    .attr("cx", 0)
                    .attr("cy", 130 + i * 25)
                    .attr("r", sizeScale(rate))
                    .attr("fill", "none")
                    .attr("stroke", "#999")
                    .attr("stroke-width", 1);

                legend.append("text")
                    .attr("x", 20)
                    .attr("y", 135 + i * 25)
                    .style("font-size", "11px")
                    .style("fill", "#666")
                    .text(`${rate}%`);
            });

            // Filter functionality
            d3.selectAll("#coach-sellers").selectAll(".filter-btn")
                .on("click", function() {
                    const badge = d3.select(this).attr("data-badge");
                    currentFilter = badge;

                    // Update button states
                    d3.selectAll("#coach-sellers").selectAll(".filter-btn")
                        .classed("active", false);
                    d3.select(this).classed("active", true);

                    // Update circles
                    circles.transition()
                        .duration(500)
                        .attr("opacity", d => {
                            if (badge === "all") return 0.6;
                            return d.badge === badge ? 0.8 : 0.1;
                        })
                        .attr("r", d => {
                            if (badge === "all") return sizeScale(d.pass_rate);
                            return d.badge === badge ? sizeScale(d.pass_rate) * 1.2 : sizeScale(d.pass_rate) * 0.8;
                        });
                });

            // Add trend line for Expert sellers
            const expertData = sellerData.filter(d => d.badge === "Expert");
            if (expertData.length > 0) {
                const lineGenerator = d3.line()
                    .x(d => x(d.products_sold))
                    .y(d => y(d.price))
                    .curve(d3.curveBasis);

                const sortedExpert = expertData.sort((a, b) => a.products_sold - b.products_sold);
                
                svg.append("path")
                    .datum(sortedExpert)
                    .attr("fill", "none")
                    .attr("stroke", badgeColors.Expert)
                    .attr("stroke-width", 2)
                    .attr("stroke-dasharray", "5,5")
                    .attr("opacity", 0.3)
                    .attr("d", lineGenerator);
            }

            // Insight annotation
            svg.append("text")
                .attr("x", width / 2)
                .attr("y", height + 70)
                .attr("text-anchor", "middle")
                .style("font-size", "13px")
                .style("font-style", "italic")
                .style("fill", "#666")
                .text("Expert sellers with higher transaction volumes tend to price more competitively");
        }

        // Initialize all visualizations
        createRaceChart();
        createRadialChart();
        createSunburst();
        createScatterPlot();
        createNetworkChart();
        createTimelineChart();
        createGeoChart();
        createHermesViolinChart();
        createHermesWaterfallChart();
        createCoachHeatmapChart();
        createCoachSellerChart();
    </script>
</body>
</html>